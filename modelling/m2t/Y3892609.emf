@namespace(uri="Y3892609")
package Y3892609;

class System {
    val Microservice [*] services;
    val CommandLineClient[*] clients;
    val KafkaTopic[*] topics;
}

class Microservice {
    attr String name;
    attr String description;
    val APISchema api;
    val DTO[*] dtos;
    val Entity[*] entities;
    val KafkaConsumer[*] kafkaConsumers;
    val KafkaProducer[*] kafkaProducers;
    val KafkaStream[*] kafkaStreams;
    val EntityRelationship[*] relationships;
}

class KafkaConsumer{
	attr String name;
	ref KafkaTopic[*]#consumers topicsReadFrom;
}

class KafkaProducer{
	attr String name;
	ref KafkaTopic[*]#producers topicsWrittenTo;
}

class KafkaStream{
	attr String name;
	ref KafkaTopic[*]#streamInputs topicsStreamedFrom;
	ref KafkaTopic[*]#streamOutputs topicsStreamedTo;
}

class KafkaTopic{
	attr String name;
	attr Boolean isStreamOutputTopic = false;
	val Field kafkaKey;
	ref DTO kafkaValue;
	ref KafkaConsumer[*]#topicsReadFrom consumers;
	ref KafkaProducer[*]#topicsWrittenTo producers;
	ref KafkaStream[*]#topicsStreamedFrom streamInputs;
	ref KafkaStream[*]#topicsStreamedTo streamOutputs;
}


class CommandLineClient {
    val CliCommand[*] commands;
}

class CliCommand {
    attr String name;
    attr String description;
}

class CliArgument {
    attr String[*] names;
    attr String type;
    attr String description;
}

class Entity {
	attr String name;
	val IdField idField;
    val DbColumnField[*] fields;
    ref EntityRelationship[*]#to incoming;
    ref EntityRelationship[*]#from outgoing;
}

class DTO{
	attr String name;
	val Field[*] fields;
}
class EntityRelationship{
    attr EntityRelationshipType type;
    attr String joinTableName;
    attr String description;
    attr Boolean isJsonIgnoreFrom = true;
    attr Boolean isJsonIgnoreTo = true;
    ref Entity#incoming to;
    val Field toField;
    ref Entity#outgoing from;
    val Field fromField;
}

enum EntityRelationshipType{
    MANY_TO_ONE;
    ONE_TO_MANY;
    MANY_TO_MANY;
}


class APISchema {
    val ClientDefinition[*] clients;
}

class ClientDefinition{
	attr String name;
	attr String urlConfigProperty;
	attr String defaultUrl;
	attr String errorType = "String";
	val HttpRequest[*] requests;
}

abstract class HttpRequest{
	attr String name;
	attr String url;
	val Field[*] urlParams;
	ref DTO responseBody;
	attr Boolean isResponseWrappedInHttpResponse = false; //ignored if string response. If true, the return type is HttpResponse<responseBody>
	attr Boolean isStringResponse = false; // Cannot have a response body if string response - enforced in EVL
}


class HttpGetRequest extends HttpRequest{
	val QueryParamField[*] queryParams;
}

class HttpNonGetRequest extends HttpRequest{
	attr HttpNonGetRequestType type;
	attr Boolean isStringRequestBody = false; // cannot have a DTO body if body is a string - enforced in EVL
	attr String stringRequestBodyName;
	ref DTO requestBody;
}

enum HttpNonGetRequestType{
	POST;
	PUT;
	DELETE;
}


class Field{
    attr String name;
    attr String type;
}

class IdField extends Field{
	attr Boolean isAutoGenerated = true;
}

class QueryParamField extends Field{
	attr Boolean isNullable = false;
}

class DbColumnField extends Field{
	attr Boolean isNullable = true;
	attr Boolean isUnique = false;
	attr Boolean hasDefaultValue = false;
	attr String defaultValue;
}
